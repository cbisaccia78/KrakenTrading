import numpy as np

import utilities as utils
from database import get_ticker_stream

# 'XBTUSD', 'ETHUSD', 'LTCUSD'

test_raw_ticker_stream = [
    {
        '2024-04-20 09:11:04.991487' : {
            'pair': 'XBT/USD',
            'data': {
                'a': ['63893.10000', '6', '6.000'], # []
                'b': ['63893.00000', '1', '1.000'], 
                'c': ['63893.00000', '0.02332814'], 
                'v': ['607.74066787', '2089.34897162'], 
                'p': ['63843.19008', '64099.38234'], 
                't': [9276, 26791], 
                'l': ['63164.00000', '63025.60000'], 
                'h': ['64270.20000', '65072.90000'], 
                'o': ['63846.00000', '63846.00000']
            }
        }
    },
    {
        '2024-04-20 09:12:04.991487' : {
            'pair': 'ETH/USD',
            'data': {
                'a': ['3893.10000', '6', '6.000'], # []
                'b': ['3893.00000', '1', '1.000'], 
                'c': ['3893.00000', '0.02332814'], 
                'v': ['07.74066787', '2089.34897162'], 
                'p': ['3843.19008', '64099.38234'], 
                't': [276, 6791], 
                'l': ['3164.00000', '63025.60000'], 
                'h': ['4270.20000', '65072.90000'], 
                'o': ['3846.00000', '3846.00000']
            }
        }
    },
    {
        '2024-04-20 09:13:04.991487' : {
            'pair': 'LTC/USD',
            'data': {
                'a': ['893.10000', '6', '6.000'], # []
                'b': ['893.00000', '1', '1.000'], 
                'c': ['893.00000', '0.02332814'], 
                'v': ['7.74066787', '2089.34897162'], 
                'p': ['843.19008', '64099.38234'], 
                't': [76, 26791], 
                'l': ['164.00000', '63025.60000'], 
                'h': ['270.20000', '65072.90000'], 
                'o': ['846.00000', '846.00000']
            }
        }
    },
    {
        '2024-04-20 09:17:04.991487' : {
            'pair': 'XBT/USD',
            'data': {
                'a': ['100000.10000', '6', '6.000'], # []
                'b': ['63893.00000', '1', '1.000'], 
                'c': ['63893.00000', '0.02332814'], 
                'v': ['607.74066787', '2089.34897162'], 
                'p': ['63843.19008', '64099.38234'], 
                't': [9276, 26791], 
                'l': ['63164.00000', '63025.60000'], 
                'h': ['64270.20000', '65072.90000'], 
                'o': ['63846.00000', '63846.00000']
            }
        }
    },
    {
        '2024-04-20 09:22:04.991487' : {
            'pair': 'LTC/USD',
            'data': {
                'a': ['1111.10000', '6', '6.000'], # []
                'b': ['63893.00000', '1', '1.000'], 
                'c': ['63893.00000', '0.02332814'], 
                'v': ['607.74066787', '2089.34897162'], 
                'p': ['63843.19008', '64099.38234'], 
                't': [9276, 26791], 
                'l': ['63164.00000', '63025.60000'], 
                'h': ['64270.20000', '65072.90000'], 
                'o': ['63846.00000', '63846.00000']
            }
        }
    }
]

def test_vectorize_ticker_stream():
    vectorized= utils.vectorize_ticker_stream(test_raw_ticker_stream)[0]
    print(len(vectorized))
    print(vectorized[0])
    print(vectorized[1])
    print(vectorized[2])

def test_top_correlated_features():
    X = np.array([
        [4,4,5,8],
        [4.1,4.2,-1,7.4],
        [3.85,3.9,-4,8.5]
    ])
    print(utils.top_correlated_features(X, X[:, 1], 2))

def test_explore_correlated_features(raw_ticker_stream, target_index, num_to_keep, stride):
    utils.explore_correlated_features(raw_ticker_stream, target_index, num_to_keep, stride)

raw_ticker_stream = get_ticker_stream('/home/cole/Code/KrakenTrading/ticker-2024-05-27')
test_explore_correlated_features(raw_ticker_stream, 'XBT/USD', 10, utils.LARGEST_MODEL_SIZE)
# test_top_correlated_features()
